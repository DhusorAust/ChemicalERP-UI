<div class="bank-page">
  <div class="toolbar">
    <div class="title">Bank</div>

    <input class="search" placeholder="Search bank..." [(ngModel)]="search" (keyup.enter)="load()" />

    <div class="pill-group">
      <button type="button" class="pill" [class.active]="status==='EDIT'" (click)="setStatus('EDIT')">Edit</button>
      <button type="button" class="pill" [class.active]="status==='APPROVED'" (click)="setStatus('APPROVED')">Approved</button>
      <button type="button" class="pill new" (click)="startCreate()">New</button>
    </div>
  </div>

  <!-- LIST -->
  <div class="content-card" *ngIf="mode==='list'">
    <div class="loading-bar" *ngIf="loading">Loading...</div>
    <div class="alert error" *ngIf="error">{{ error }}</div>

    <div class="table-wrap" *ngIf="!loading">
      <table class="bank-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>BANK NAME</th>
            <th>SHORT</th>
            <th>SWIFT</th>
            <th>ADDRESS</th>
            <th>ACTIVE</th>
            <th>APPROVED</th>
            <th style="width:80px;"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of items">
            <td>{{ r.BankID }}</td>
            <td [class.bold]="!!r.BankName && r.BankName.length>2">{{ r.BankName || '—' }}</td>
            <td>{{ r.BankShortName || '—' }}</td>
            <td>{{ r.SwiftCode || '—' }}</td>
            <td>{{ r.BankAddress || '—' }}</td>
            <td>{{ r.IsActive===1 ? 'Yes' : 'No' }}</td>
            <td>{{ r.Approved ? 'Yes' : 'No' }}</td>
            <td>
              <button class="pill mini" (click)="startEdit(r)">Edit</button>
            </td>
          </tr>
          <tr *ngIf="!items?.length">
            <td colspan="8" class="empty">No data found</td>
          </tr>
        </tbody>
      </table>
      <div class="total">Total: {{ items?.length || 0 }}</div>
    </div>
  </div>

  <!-- FORM -->
  <div class="content-card" *ngIf="mode!=='list'">
    <div class="form-head">{{ mode==='create' ? 'New Bank' : 'Edit Bank' }}</div>

    <div class="alert error" *ngIf="saveError">{{ saveError }}</div>
    <div class="alert ok" *ngIf="saveSuccess">{{ saveSuccess }}</div>

    <form class="form-grid" (ngSubmit)="submit()" autocomplete="off" novalidate>
      <label>Bank Name
        <input class="in" [(ngModel)]="form.BankName" name="BankName" required />
      </label>
      <label>Bank Code
        <input class="in" [(ngModel)]="form.BankCode" name="BankCode" />
      </label>
      <label>Short Name
        <input class="in" [(ngModel)]="form.BankShortName" name="BankShortName" />
      </label>
      <label>Swift Code
        <input class="in" [(ngModel)]="form.SwiftCode" name="SwiftCode" />
      </label>
      <label class="span2">Address
        <input class="in" [(ngModel)]="form.BankAddress" name="BankAddress" />
      </label>

      <div class="checks span2">
        <label><input type="checkbox" [(ngModel)]="form.IsActiveBool" name="IsActiveBool" /> Active</label>
        <label><input type="checkbox" [(ngModel)]="form.IsBeneficiaryBankBool" name="IsBeneficiaryBankBool" /> Beneficiary</label>
        <label><input type="checkbox" [(ngModel)]="form.IsAdvisingBankBool" name="IsAdvisingBankBool" /> Advising</label>
        <label><input type="checkbox" [(ngModel)]="form.IsNegoBankBool" name="IsNegoBankBool" /> Negotiating</label>
        <label><input type="checkbox" [(ngModel)]="form.Approved" name="Approved" /> Approved</label>
      </div>

      <div class="form-actions span2">
        <button class="pill submit" type="submit" [disabled]="saving">
          {{ saving ? (mode==='edit' ? 'Updating...' : 'Saving...') : (mode==='edit' ? 'Update' : 'Save') }}
        </button>
        <button class="pill" type="button" (click)="cancelForm()" [disabled]="saving">Cancel</button>
      </div>
    </form>
  </div>
</div>
