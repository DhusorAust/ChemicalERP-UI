<div class="bank-wrap">
  <div class="card card-head">
    <div class="card-header">
      <div class="head-left">
        <button type="button" class="btn btn-light" (click)="backToList()" *ngIf="mode==='form'">← Back</button>
        <h2 class="title">Bank</h2>
      </div>
      <div class="head-right" *ngIf="mode==='list'">
        <button class="btn btn-primary" (click)="openNew()">+ Add New</button>
      </div>
    </div>
  </div>

  <!-- LIST -->
  <div class="card" *ngIf="mode==='list'">
    <div class="card-body">
      <div *ngIf="loading" class="alert info">Loading...</div>
      <div *ngIf="error" class="alert danger">{{ error }}</div>

      <div class="table-responsive" *ngIf="!loading && rows.length">
        <table class="table">
          <thead>
            <tr>
              <th style="width:110px">Action</th>
              <th>Bank Name</th>
              <th>Short</th>
              <th>Swift</th>
              <th>Active</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of rows; trackBy: trackById">
              <td><button class="btn btn-outline" (click)="openEdit(r)">Edit</button></td>
              <td class="text-strong">{{ r.BankName }}</td>
              <td>{{ r.BankShortName || '—' }}</td>
              <td>{{ r.SwiftCode || '—' }}</td>
              <td>
                <span class="badge" [class.badge-success]="r.IsActive" [class.badge-muted]="!r.IsActive">
                  {{ (r.IsActive?1:0) ? 'Yes' : 'No' }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="!loading && !rows.length" class="empty">
        <div class="empty-title">No banks found</div>
        <div class="empty-sub">Start by adding your first bank.</div>
        <button class="btn btn-primary mt-2" (click)="openNew()">+ Add Bank</button>
      </div>
    </div>
  </div>

  <!-- FORM -->
  <form class="card" *ngIf="mode==='form'" [formGroup]="frm" (ngSubmit)="save()">
    <div class="card-body">
      <div *ngIf="error" class="alert danger mb-3">{{ error }}</div>
      <div *ngIf="info" class="alert success mb-3">{{ info }}</div>

      <div class="grid">
        <div class="field">
          <label class="form-label">Bank Name <span class="req">*</span></label>
          <input class="form-control"
                 formControlName="BankName"
                 [class.is-invalid]="submitted && frm.controls.BankName.invalid"
                 placeholder="e.g., City Bank Ltd.">
          <div class="invalid" *ngIf="submitted && frm.controls.BankName.invalid">Bank Name is required</div>
        </div>

        <div class="field">
          <label class="form-label">Short Name</label>
          <input class="form-control" formControlName="BankShortName" placeholder="e.g., CBL">
        </div>

        <div class="field">
          <label class="form-label">SWIFT Code</label>
          <input class="form-control" formControlName="SwiftCode" placeholder="e.g., CIBLBDDHXXX">
        </div>

        <div class="field">
          <label class="form-label">Active</label>
          <select class="form-select" formControlName="IsActive">
            <option [ngValue]="1">Yes</option>
            <option [ngValue]="0">No</option>
          </select>
        </div>

        <div class="field col-span-2">
          <label class="form-label">Address</label>
          <textarea class="form-control" rows="3" formControlName="BankAddress" placeholder="Branch/Corporate address"></textarea>
        </div>
      </div>
    </div>

    <div class="card-footer actions">
      <button class="btn btn-primary" type="submit" [disabled]="saving">
        <span *ngIf="saving" class="spinner"></span>{{ saving ? 'Saving...' : 'Save' }}
      </button>
      <button class="btn btn-outline" type="button" (click)="backToList()">Cancel</button>
    </div>
  </form>
</div>
