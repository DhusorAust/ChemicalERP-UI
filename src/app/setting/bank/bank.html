<!-- path: src/app/bank/bank.html -->
<div class="bank-wrap">
  <!-- Header -->
  <div class="card card-head">
    <div class="card-header">
      <h2 class="title">Bank</h2>
      <div class="head-right">
        <ng-container *ngIf="mode==='list'; else formHeader">
          <input class="form-control" placeholder="Search bank..." [(ngModel)]="search" (keyup.enter)="onSearchEnter()">
          <div class="btn-group">
            <button type="button" class="btn btn-outline"
                    [class.btn-primary]="status==='ALL'" (click)="setStatus('ALL')">All</button>
            <button type="button" class="btn btn-outline"
                    [class.btn-primary]="status==='EDIT'" (click)="setStatus('EDIT')">Edit</button>
            <button type="button" class="btn btn-outline"
                    [class.btn-primary]="status==='APPROVED'" (click)="setStatus('APPROVED')">Approved</button>
          </div>
          <button type="button" class="btn btn-outline" (click)="refresh()">Refresh</button>
          <button type="button" class="btn btn-primary" (click)="startCreate()">Add New</button>
        </ng-container>

        <ng-template #formHeader>
          <button type="button" class="btn btn-outline" (click)="cancelForm()">Back to List</button>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- List View -->
  <div class="card" *ngIf="mode==='list'">
    <div class="card-body">
      <div *ngIf="loading" class="alert info">Loading...</div>
      <div *ngIf="error" class="alert danger">{{ error }}</div>

      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th (click)="toggleSort('BankID')" style="width:90px;cursor:pointer">
                ID <span *ngIf="sortField==='BankID'">{{ sortDir==='asc' ? '▲' : '▼' }}</span>
              </th>
              <th (click)="toggleSort('BankName')" style="cursor:pointer">
                BANK NAME <span *ngIf="sortField==='BankName'">{{ sortDir==='asc' ? '▲' : '▼' }}</span>
              </th>
              <th (click)="toggleSort('BankShortName')" style="cursor:pointer">
                SHORT <span *ngIf="sortField==='BankShortName'">{{ sortDir==='asc' ? '▲' : '▼' }}</span>
              </th>
              <th (click)="toggleSort('SwiftCode')" style="cursor:pointer">
                SWIFT <span *ngIf="sortField==='SwiftCode'">{{ sortDir==='asc' ? '▲' : '▼' }}</span>
              </th>
              <th (click)="toggleSort('BankAddress')" style="cursor:pointer">
                ADDRESS <span *ngIf="sortField==='BankAddress'">{{ sortDir==='asc' ? '▲' : '▼' }}</span>
              </th>
              <th (click)="toggleSort('IsActive')" style="width:90px;cursor:pointer">
                ACTIVE <span *ngIf="sortField==='IsActive'">{{ sortDir==='asc' ? '▲' : '▼' }}</span>
              </th>
              <th (click)="toggleSort('Approved')" style="width:110px;cursor:pointer">
                APPROVED <span *ngIf="sortField==='Approved'">{{ sortDir==='asc' ? '▲' : '▼' }}</span>
              </th>
              <th style="width:80px">ACTIONS</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let r of items">
              <td>{{ r.BankID }}</td>
              <td class="text-strong">{{ r.BankName }}</td>
              <td>{{ r.BankShortName || '—' }}</td>
              <td>{{ r.SwiftCode || '—' }}</td>
              <td>{{ r.BankAddress || '—' }}</td>
              <td>{{ (r.IsActive ? 1 : 0) ? 'Yes' : 'No' }}</td>
              <td>{{ (r.Approved ? 1 : 0) ? 'Yes' : 'No' }}</td>
              <td>
                <button type="button" class="icon-btn" title="Edit" (click)="startEdit(r)">✏️</button>
              </td>
            </tr>

            <tr *ngIf="!items.length && !loading">
              <td colspan="8" class="empty">NO DATA FOUND</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="card-footer">
        <div class="text-muted">Total: {{ total }}</div>
      </div>
    </div>
  </div>

  <!-- Create/Edit Form View -->
  <div class="card" *ngIf="mode==='create' || mode==='edit'">
    <div class="card-body">
      <div *ngIf="saveSuccess" class="alert info">{{ saveSuccess }}</div>
      <div *ngIf="saveError" class="alert danger">{{ saveError }}</div>

      <form (ngSubmit)="submit()" #f="ngForm" novalidate>
        <div class="form-grid">
          <label *ngIf="mode==='edit'">
            <div>Bank ID</div>
            <input class="form-control" [value]="newBank?.BankID" disabled>
          </label>

          <label [class.col-span-2]="mode==='create'">
            <div>Bank Name <span class="req">*</span></div>
            <input class="form-control" name="BankName" [(ngModel)]="newBank!.BankName" required>
          </label>

          <label>
            <div>Short Name</div>
            <input class="form-control" name="BankShortName" [(ngModel)]="newBank!.BankShortName">
          </label>

          <label>
            <div>SWIFT Code</div>
            <input class="form-control" name="SwiftCode" [(ngModel)]="newBank!.SwiftCode">
          </label>

          <label class="col-span-2">
            <div>Address</div>
            <input class="form-control" name="BankAddress" [(ngModel)]="newBank!.BankAddress">
          </label>

          <label class="check">
            <input type="checkbox" [(ngModel)]="newBank!.IsActive" name="IsActive">
            <span>Active</span>
          </label>

          <label class="check">
            <input type="checkbox" [(ngModel)]="newBank!.Approved" name="Approved">
            <span>Approved</span>
          </label>
        </div>

        <div class="card-footer">
          <div class="btn-group">
            <button type="button" class="btn" (click)="cancelForm()" [disabled]="saving">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="saving || !f.form.valid">
              {{ saving ? (mode==='edit' ? 'Updating...' : 'Saving...') : (mode==='edit' ? 'Update' : 'Save') }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
